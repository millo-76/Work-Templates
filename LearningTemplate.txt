!====C9800 & C3850 Templates

!====Cisco C9800 Wireless LAN Controller Configuration

!====Global Configuration & Hardening
hostname $WLCName$		// Sets the device name (hostname)
ip domain-name uccs.edu		// Sets the domain name (used for SSH keys too).
no ip domain-lookup		// Prevents slow DNS lookups on CLI typos.
service timestamps debug datetime msec	// Adds detailed debug timestamps.
service timestamps log datetime msec	// Adds detailed log timestamps.
no service pad                          // Disables PAD (legacy).
service password-encryption		// Encrypts all passwords in the config.
secure boot-image			// Protects IOS image from tampering.
secure boot-config			// Protects config from tampering.
security passwords min-length 12	// Enforces minimum password length.
no ip http server			// Disables insecure HTTP server.
no ip http secure-server		// Disables secure HTTP server
no ip source-route			// Disables source routing
no cdp run				// Disables Cisco Discovery Protocol globally.
no lldp run				// Disables Link Layer Discovery Protocol globally.

!====SSH Configuration
crypto key generate rsa modulus 2048	// Generates 2048bit RSA key for SSH.
ip ssh version 2			// Enforces SSH v2 use.
ip ssh time-out 60			// Disconnects idle SSH session.
ip ssh authentication-retries 2		// Limits SSH login attempts.

!====AAA & RADIUS
aaa new-model					// Enables AAA services.
aaa authentication dot1x default group radius	// Uses RADIUS for .1X authentication.
aaa authorization network default group radius	// Uses RADIUS for authorization.
aaa accounting update periodic 5		// Sends accounting updates when specified.
aaa accounting exec default start-stop group radius	// Logs exec sessions on start/stop.
aaa accounting system default start-stop group radius	// Logs system events.

radius-server host $radiusIP$ auth-port 1812 acct-port 1813 key $radiusKey$ // Defines RADUIS server and ports.
radius-server timeout 5		// Sets RADIUS server response timeout.
radius-server retransmit 3	// Sets number of retry attemps.
ip radius source-interface Vlan$MgmtVLAN$	// Uses designated VLAN for RADIUS packets.

dot1x system-auth-control	// Enables .1X globally.

!====Local Admin
Username admin privilege 15 secret $adminSecret$	// Creates a local fall-back administrator.

!====Console & VTY Access
Line console 0
  login local	// Sets console login to local.
  exec-timeout 10 0	// Sets timeout.
  logging synchronous	// Logging messages will not interupt commands.

line vty 0 15
  login authentication default	// Uses AAA for SSH login
  exec-timeout 10 0		// Sets timeout.
  transport input ssh		// Allows for only SSH.
  access-class MGMT_ACCESS in	// Restricts VTY access.

ip access-list standard MGMT_ACCESS
  permit $mgmtSubnet$ 0.0.0.255	// Allows access from management subnet.
  deny any log			// Denys and logs other access attempts.

!====VLAN Definitions
Vlan $vlanNumber$
  name $vlanName$
vlan $vlanNumber$
  name $vlanName$

!====Management Interface
Interface Vlan$mgmtVlan$
  ip address $mgmtIP$ $subNet$
  ip flow monitor CAMPUS-MONITOR input
  no shutdown

AP Uplink
Interface GigabitEthernet$apPort$
  description AP Uplink
  switchport mode access
  switchport access vlan $vlanNumber$
  spanning-tree portfast
  spanning-tree bpduguard enable
  ip dhcp snooping trust
  ip arp inspection trust
  mls qos trust dscp
  service-policy input MARKING
  mtu 1500

DOT1X Access Port
Template type interface DOT1X_TEMPLATE
  service-policy input MARKING
  authentication port-control auto
  authentication periodic
  authentication timer reauthenticate server
  dot1x pae authenticator
  mab
  authentication priority dot1x mab
  authentication event fail action authorize vlan $vlanNumber$
  authentication event server dead action authorize vlan $vlanNumber$
  authentication event no-response action authorize vlan $vlanNumber$
  authentication host-mode multi-auth
  authentication violation restrict
  spanning-tree portfast
  spanning-tree bpduguard enable
  spanning-tree guard root
  storm-control broadcast level 1.00
  storm-control action shutdown
  switchport port-security
  switchport port-security maximum 2
  switchport port-security violation restrict
  switchport port-security mac-address sticky
  ip dhcp snooping trust

User Access Port Range
Interface range GigabitEthernet$firstPort$ - $lastPort$
  description Wired Client Access
  switchport mode access
  switchport access vlan $vlanNumber&
  load-interval 30
  storm-control broadcast level 10.00
  service-policy input MARK-DOT1X-TRAFFIC
  source template DOT1X_TEMPLATE

VoIP Port
Interface GigabitEthernet$PortNumber$
  description IP Phone + PC
  switchport mode access
  switchport access vlan $vlanNumber$
  switchport voice vlan $voiceVlan$
  source template DOT1X_TEMPLATE
  authentication host-mode multi-domain

DHCP Snooping & ARP Inspection
Ip dhcp snooping
ip dhcp snooping vlan $vlan$,$vlan$
no ip dhcp snooping information option
ip dhcp snooping verify mac-address

ip arp inspection vlan $vlan$,$vlan$,$vlan$

NetFlow Configuration
Ip flow-export version 9
flow exporter CAMPUS-EXPORT
  destination $netflowCollextor$
  source Vlan$mgmtVlan$
  transport udp 2055
  template data timeout 60

flow record netflow-original
  match ipv4 source address
  match ipv4 destination address
  collect counter bytes
  collect counter packets
  collect timestamp sys-uptime first
  collect timestamp sys-uptime last

flow monitor CAMPUS-MONITOR
  exporter CAMPUS-EXPORT
  record netflow-original
  cache timeout active 60

NTP Configuration
Ntp authenticate
ntp authentication-key 1 md5 $ntpKey$
ntp trusted-key 1
ntp server $ntpServer$ key 1 prefer

Control Plane Policing
Control-plane
  service-policy input CONTROL_PLANE_POLICY

policy-map CONTROL_PLANE_POLICY
  class CONTOL_PLANE_CLASS
    police 64000 8000 conform-action transmit exceed-action drop violate-action drop

class-map match-any CONTROL_PLANE_CLASS
  match protocol ssh
  match protocol snmp
  match protocol ntp
  match protocol arp
  match protocol dhcp

policy-map CONTROL_PLANE_POLICY
  class CONTROL_PLANE_CLASS
    police 64000 8000 conform-action transmit exceed-action drop violate-action drop

SNMP Configuration
No snmp-server community public
no snmp-server community private
snmp-server group SECURE v3 priv
snmp-server user admin SECURE v3 auth sha $snmpAuth$ priv aes 256 $snmpPriv$
snmp-server enable traps
snmp-server contact $snmpContact$
snmp-server location $snmpLocation$

Syslog & Archive
Logging buffered 100000 warnings
logging trap informational
logging host $syslogIP$
service sequence-numbers

archive
  log config
    logging enable
    notify syslog
    hidekeys

Save Configuration
End
write memory


Cisco 3850 Access Switch Configuration (Learning Template)
Hostname and Basic Security Configuration
hostname $SwitchName$		// Sets the device hostname.
no ip domain-lookup			// Prevents slow DNS lookups on CLI typos.
enable secret $enableSecret$	// Sets the privileged exec password.
service password-encryption	// Encrypts all plaintext passwords.
secure boot-image		// Verifies image integrity at boot.
secure boot-config		// Verifies config integrity at boot.
security passwords min-length 12	// Enforces a strong password policy.

Banner
Banner motd ^
Banner Message ^

Time & Logging
Clock timezone MST -7
clock summer-time MDT recurring
ntp server $ntpServer1$
ntp server $ntpServer2$
ntp authenticate
ntp authentication-key 1 md5 $ntpKey$
ntp trusted-key 1

service timestamps log datetime msec localtime show-timezone
service timestamps debug datetime msec localtime show-timezone

logging buffered 100000
logging trap informational
logging host $syslogServer$
logging source-interface Vlan$mgmtVlan$

arhive
  path flash:backup-$switchName$-config
  write-memory
  log config
    logging enable
    notify syslog
    hidekeys

AAA & RADIUS
Aaa new-model
aaa group server radius RADIUS-GROUP
  server name $radiusServer1$
  server name $radiusServer2$
aaa authentication dot1x default group RADIUS-GROUP
aaa authorization network default group RADIUS-GROUP
aaa accounting update periodic 5
aaa accounting dot1x default start-stop group RADIUS-GROUP
aaa accounting exec default start-stop group RADIUS-GROUP
aaa accounting commands 15 default start-stop group RADIUS-GROUP

radius-server host $radiusIP$ auth-port 1812 acct-port 1813 key $radiusKey$
radius-server timeout 5
radius-server retransmit 3
radius-server deadtime 10
ip radius source-interface Vlan$MgmtVLAN$

username admin privilege 15 secret $adminSecret$

Console & SSH Access
Ip domain-name uccs.edu
ip ssh version 2
ip ssh time-out 60
ip ssh authentication-retries 2
ip ssh logging events
crypto key generate rsa modulus 2048

line console 0
  login local
  exec-timeout 5 0
  logging synchronous

line vty 0 15
  login authentication default
  transport input ssh
  exec-timeout 10 0
  access-class MGMT_ACCESS in

ip access-list standard MGMT_ACCESS
  permit $mgmtSubnet$ 0.0.0.255
  deny any
SNMP
no snmp-server community public
no snmp-server community private
no snmp-server community $read$
no snmp-server community $write$

snmp-server group SECURE v3 priv
snmp-server user $snmpUser$ SECURE v3 auth sha $snmpAuth$ priv aes 256 $snmpPriv$
snmp-server location $location$
snmp-server contact $adminContact$
VLANs
vlan $vlanNumber$
  name $vlanName$
vlan $vlanNumber$
  name $vlanName$
SVI
interface Vlan$mgmtVlan$
  ip address $mgmtIP$ $mgmtMask$
  ip flow monitor UserMonitor input
  no shutdown

ip default-gateway $mgmtGateway$
DOT1X Template
template type interface DOT1X_TEMPLATE
  service-policy input MARKING
  authentication port-control auto
  authentication periodic
  authentication timer reauthenticate server
  dot1x pae authenticator
  mab
  authentication priority dot1x mab
  authentication event fail action authorize vlan $vlan$
  authentication event server dead action authorize vlan $vlan$
  authentication event no-response action authorize vlan $vlan$
  authentication host-mode multi-auth
  authentication violation restrict
  spanning-tree portfast
  spanning-tree bpduguard enable
  spanning-tree guard root
  storm-control broadcast level 1.00
  storm-control action shutdown
  switchport port-security
  switchport port-security maximum 2
  switchport port-security violation restrict
  switchport port-security mac-address sticky
  ip dhcp snooping trust
  ip arp inspection trust
  mls qos trust dscp
User Access Port (VoIP)
interface G$portNo$
  description User Access Upink
  switchport mode access
  switchport access vlan $vlanNo$
  switchport voice vlan $voiceVlan$
  source template DOT1X_TEMPLATE
  load-interval 30
Wireless AP Port
interface G$portNo$
  description Wireless AP Uplink
  switchport mode access
  switchport access vlan $vlanNo$
  spanning-tree portfast
  spanning-tree bpduguard enable
  mls qos trust dscp
  ip dhcp snooping trust
  ip arp inspection trust
Trunked Ports
interface G$portNo$
  description Uplink to Core/Distribution
  switchport trunk encapsulation dot1q
  switchport mode trunk
  switchport trunk allowed vlan $vlan$,$vlan$,$vlan$
  spanning-tree portfast trunk
  spanning-tree bpduguard enable
  spanning-tree guard root
  mls qos trust dscp
  ip dhcp snooping trust
  ip arp inspection trust
DHCP Snooping & ARP Inspection
ip dhcp snooping
ip dhcp snooping vlan $vlanNo$
no ip dhcp snooping information option
ip dhcp snooping verify mac-address

ip arp inspection vlan $vlanNo$
QoS & Control-plane Protection
mls qos
interface G$portNo$
  mls qos trust dscp

control-plane
  service-policy input CONTROL_PLANE_POLICY

policy-map CONTROL_PLANE_POLICY
  class CONTROL_PLANE_CLASS
    police 64000 8000 conform-action transmit exceed-action drop violate-action drop

class-map match-any CONTROL_PLANE_CLASS
  match protocol ssh
  match protocol snmp
  match protocol ntp
  match protocol arp
  match protocol dhcp
NetFlow Configuration
flow exporter CampusFlow
  destination $flowCollector$
  source Vlan$mgmtVlan$
  transport udp 9996
  template data timeout 60

flow record netflow-original
  match ipv4 source address
  match ipv4 destination address
  collect counter bytes
  collect counter packets
  collect timestamp sys-uptime first
  collect timestamp sys-uptime last

flow monitor UserMonitor
  record netflow-original
  exporter CampusFlow
Save Configuration
end
write memory
